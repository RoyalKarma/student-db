;

DROP TABLE IF EXISTS [student] ;
CREATE TABLE student (
  [id_student] INT NOT NULL IDENTITY,
  [first_name] VARCHAR(45) NOT NULL,
  [last_name] VARCHAR(45) NOT NULL,
  [year] SMALLINT NOT NULL,
  PRIMARY KEY ([id_student]));

DROP TABLE IF EXISTS [study_program] ;
CREATE TABLE study_program (
  [program_id] INT NOT NULL IDENTITY,
  [program_name] VARCHAR(45) NOT NULL,
  PRIMARY KEY ([program_id]));

DROP TABLE IF EXISTS [student_has_study_program] ;
CREATE TABLE student_has_study_program (
  [id] INT NOT NULL IDENTITY,
  [student_id] INT NOT NULL,
  [program_id] INT NOT NULL,
  PRIMARY KEY ([id], [student_id], [program_id]),
  CONSTRAINT [fk_student_has_study_program_student]
    FOREIGN KEY ([student_id])
    REFERENCES student ([id_student])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT [fk_student_has_study_program_study_program1]
    FOREIGN KEY ([program_id])
    REFERENCES study_program ([program_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

DROP TABLE IF EXISTS [subject] ;
CREATE TABLE subject (
  [subject_id] INT NOT NULL IDENTITY,
  [subject_name] VARCHAR(45) NOT NULL,
  PRIMARY KEY ([subject_id]));

DROP TABLE IF EXISTS [student_has_subject] ;
CREATE TABLE student_has_subject (
  [id] INT NOT NULL IDENTITY,
  [student_id] INT NOT NULL,
  [subject_id] INT NOT NULL,
  PRIMARY KEY ([id], [student_id], [subject_id]),
  CONSTRAINT [fk_student_has_subject_student1]
    FOREIGN KEY ([student_id])
    REFERENCES student ([id_student])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT [fk_student_has_subject_subject1]
    FOREIGN KEY ([subject_id])
    REFERENCES subject ([subject_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

DROP TABLE IF EXISTS [study_program_has_subject] ;
CREATE TABLE study_program_has_subject (
  [id] INT NOT NULL IDENTITY,
  [program_id] INT NOT NULL,
  [subject_id] INT NOT NULL,
  PRIMARY KEY ([id], [program_id], [subject_id]),
  CONSTRAINT [fk_study_program_has_subject_study_program1]
    FOREIGN KEY ([program_id])
    REFERENCES study_program ([program_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT [fk_study_program_has_subject_subject1]
    FOREIGN KEY ([subject_id])
    REFERENCES subject ([subject_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

DROP TABLE IF EXISTS [faculty] ;
CREATE TABLE faculty (
  [faculty_id] INT NOT NULL IDENTITY,
  [name] VARCHAR(45) NOT NULL,
  PRIMARY KEY ([faculty_id]));

DROP TABLE IF EXISTS [study_program_has_faculty] ;
CREATE TABLE study_program_has_faculty (
  [id] INT NOT NULL IDENTITY,
  [program_id] INT NOT NULL,
  [faculty_id] INT NOT NULL,
  PRIMARY KEY ([id], [program_id], [faculty_id]),
  CONSTRAINT [fk_study_program_has_faculty_study_program1]
    FOREIGN KEY ([program_id])
    REFERENCES study_program ([program_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT [fk_study_program_has_faculty_faculty1]
    FOREIGN KEY ([faculty_id])
    REFERENCES faculty ([faculty_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

DROP TABLE IF EXISTS [grade] ;
CREATE TABLE grade (
  [grade_id] INT NOT NULL IDENTITY,
  [student_id] INT NOT NULL,
  [subject_id] INT NOT NULL,
  [grade] INT NULL,
  PRIMARY KEY ([grade_id], [student_id], [subject_id]),
  CONSTRAINT [fk_grade_student1]
    FOREIGN KEY ([student_id])
    REFERENCES student ([id_student])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT [fk_grade_subject1]
    FOREIGN KEY ([subject_id])
    REFERENCES subject ([subject_id])
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);